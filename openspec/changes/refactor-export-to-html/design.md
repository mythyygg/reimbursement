## Context

当前导出功能支持 ZIP（包含 CSV + YAML + 票据文件）和 CSV 两种格式。用户需要：
1. 点击导出记录进入详情页
2. 选择导出格式
3. 等待生成完成
4. 下载文件

这个流程对于查看报销报告来说过于复杂。用户真正需要的是一个可以直接查看、打印的报告。

## Goals / Non-Goals

**Goals:**
- 简化用户交互：在列表页直接下载，无需进入详情页
- 提供美观的 HTML 报告，包含费用清单和票据图片
- 支持打印友好的样式
- 票据图片内嵌到 HTML（Base64），确保离线可用

**Non-Goals:**
- 不再支持 ZIP 和 CSV 格式（简化实现）
- 不支持 PDF 导出（HTML 可通过浏览器打印为 PDF）
- 不支持票据文件单独下载（内嵌到 HTML 中）

## Decisions

### 1. 导出格式选择 HTML

**决定**: 使用自包含的 HTML 文件作为唯一导出格式

**理由**:
- 无需额外软件即可查看（浏览器通用）
- 可通过浏览器「打印为 PDF」功能获得 PDF
- 票据图片可内嵌为 Base64，确保文件自包含
- 支持丰富的样式和布局

**替代方案**:
- PDF：需要额外库（如 puppeteer），增加服务端复杂度
- 保留 ZIP：用户仍需解压查看，不如 HTML 直观

### 2. 票据展示方式

**决定**: 所有票据（图片和 PDF）统一展示为缩略图，点击后显示放大原图

**理由**:
- 缩略图布局紧凑，一览无余
- 点击放大符合用户直觉
- 统一的交互体验，无论是图片还是 PDF

**实现方式**:
- 图片票据：生成缩略图（约 150px 宽度），原图内嵌为 Base64
- PDF 票据：生成首页缩略图，原 PDF 内嵌为 Base64 data URL
- 点击缩略图后弹出模态框显示原图/原 PDF
- 模态框支持点击关闭

### 3. 票据内嵌方式

**决定**: 将票据（图片和 PDF）转为 Base64 内嵌到 HTML

**理由**:
- 文件自包含，离线可用
- 无需维护额外的图片服务
- 适用于常见的报销场景（票据数量有限）

**限制**:
- 文件可能较大（取决于票据数量和大小）
- 建议服务端压缩图片到合理大小

### 4. 页面结构调整

**决定**: 移除 `/batches/[batchId]` 详情页，在列表页直接操作

**理由**:
- 简化用户流程
- 减少代码维护
- 下载操作简单，不需要专门的详情页

## Risks / Trade-offs

| 风险 | 缓解措施 |
|------|----------|
| HTML 文件过大（票据多时） | 可设置单次导出票据数量上限，或压缩图片 |
| 用户习惯 ZIP 格式 | 提供迁移提示，HTML 功能更强大 |
| PDF 票据预览生成复杂 | 先实现简单版本（显示 PDF 图标 + 链接），后续迭代 |

## Migration Plan

1. 新增 HTML 导出类型，与现有 ZIP/CSV 并存测试
2. 验证 HTML 生成正确后，移除 ZIP/CSV 支持
3. 删除详情页，更新列表页 UI
4. 清理无用代码

## Open Questions

1. 是否需要支持批量导出（多个批次合并到一个 HTML）？
   - 初期建议不支持，保持简单
2. 票据图片压缩策略？
   - 建议服务端统一压缩到合理大小（如 800px 宽度）
