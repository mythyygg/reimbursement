下面是我对你整理的 PRD + UI 设计**重新审视、统一口径、补齐缺口**后的“可交付完整版”。我做了这些关键修订（已体现在正文中，不再单独展开）：

- 去重：删除重复段落与重复标题，形成一份“从目标 → 范围 → 需求 → 数据 → 验收 → UI/UX → 视觉规范”的单一版本。
- 补齐：把你只写到 Screen 0 的部分补全为 Screen 0–9 的完整交互状态与文案。
- 统一：字段命名、状态命名、按钮文案、页面入口逻辑一致。
- 明确规则：票据与支出的匹配规则给出默认策略（避免后期实现歧义）。
- 落地性增强：增加关键边界场景、错误处理、离线/上传队列、OCR 失败策略、候选匹配置信度计算与提示策略。

---

# PRD：项目报销收纳与装订工具（方案 B：标准版 + 轻 OCR + 智能候选匹配）

## 0. 概要

**产品定位**：报销准备工具（Reimbursement Prep），用于“项目维度”集中记录垫付支出与票据材料，完成匹配核对并导出报销包。
**不做**传统记账（预算、账户体系、报表、资产管理等）。
**移动端优先**：Web/PWA（可添加到主屏幕），单手可用、现场录入快。

---

## 1. 背景与问题

目前用 iPhone 备忘录记录垫付（日期/支出/备注），票据截图散落在多个 App、相册与文件。报销时需要回溯截图并补齐材料，易出现：

- 找票慢、漏票
- 重复票据（同一张截图重复用）
- 票据金额/日期与支出不一致，导致退回
- 报销前整理耗时高

---

## 2. 产品目标与成功指标

### 2.1 目标

1. **现场录入接近备忘录速度**，且每笔支出必须挂在项目下。
2. **票据集中收纳**（项目内收纳箱），支持截图/文件/PDF，便于后续匹配。
3. **导出前自动生成问题清单**（缺票/重复/不一致），降低退回。
4. 通过**轻 OCR**与**智能候选匹配**减少人工填字段与手动找票成本（必须人工确认）。

### 2.2 成功指标（上线后 4 周）

- 新增支出：熟练用户中位数 ≤ 6 秒，P90 ≤ 12 秒
- 票据入库到“可用状态”（归项目 + OCR/建议可用）：中位数 ≤ 15 秒
- 导出前问题发现率（缺票/重复/不一致）：≥ 90%
- 用户主观：报销整理耗时下降 ≥ 50%

---

## 3. 范围（Scope）

### 3.1 In Scope（本期）

- 项目：创建/搜索/置顶/归档
- 支出：快速录入、编辑、筛选、状态管理（缺票/已关联/不需票）
- 票据收纳箱：上传（多选）、预览、OCR 预填、去重提示
- 匹配：票据 ↔ 支出（人工确认）
- 智能候选匹配：按规则输出 Top 3 建议（人工确认）
- 批次：按日期/筛选创建 → 检查清单 → 导出 CSV + ZIP（可选 PDF 汇总页）
- 设置：类别、导出字段模板、OCR 开关、匹配策略开关

### 3.2 Out of Scope（明确不做）

- 记账类：预算、报表、分账、账户体系
- 供应商/合同/开票信息管理
- 自动绑定票据（无人工确认）、绕过核对的逻辑

---

## 4. 用户画像与使用场景

**主用户**：艺宣/执行经纪，移动场景频繁，周期性集中报销。

**典型场景**

- 现场/路上：随手录支出（打车/餐饮/快递/物料）
- 拍摄/制作日：多笔集中录入，票据先丢收纳箱，晚些补匹配
- 报销前：按项目创建批次，清问题清单，导出上传

---

## 5. 核心业务规则（默认策略）

1. **每笔支出必须属于某项目**（入口默认上次项目）。
2. **票据可先归项目，再匹配支出**（适配截图来源分散）。
3. **匹配必须人工确认**（候选仅建议）。
4. **去重不拦截，只提示风险**（避免误伤：同商户同金额等）。
5. **金额不一致不拦截，但进入问题清单并要求备注说明**。
6. **默认匹配关系：1 张票据 → 1 笔支出**（降低重复/误用风险）。

   - 如未来需要“拆分/合并”，建议作为后续增强：进入“拆分模式”并强制备注说明。

---

## 6. 功能需求（Functional Requirements）

### 6.1 项目模块

- 创建项目：项目名/项目号（二选一必填）
- 项目列表：最近使用、置顶、搜索、归档入口
- 项目卡片摘要：缺票数、未导出支出数、最近更新日期
- 归档：隐藏已结束项目（仍可搜索/查看）

### 6.2 支出模块（项目内）

- 快速新增（单行输入 + 可选语音）

  - 必填：金额（合法数值）、备注（建议必填，可配置为强制）
  - 默认：日期=今天；类别可空；状态=缺票

- 支出列表

  - 排序：默认“缺票优先 + 日期倒序”（可切换为纯日期倒序）
  - 筛选：全部/缺票/已关联/不需票；类别；日期范围

- 支出详情（抽屉）

  - 编辑：日期、金额、类别、备注、状态
  - 附件：查看、添加、移除
  - 建议票据：显示 Top 3（若有）+ 一键确认绑定
  - 从收纳箱选择：手动搜索/筛选后确认绑定

### 6.3 票据收纳箱（项目内）

- 上传：相册多选、文件选择、分享至 PWA（如实现）
- 票据卡片：

  - 缩略图/预览
  - OCR 结果（若开启）：金额、日期、商户关键字（可编辑）
  - 去重提示（疑似重复）
  - 候选匹配（Top 3）+ 人工确认

- 操作：删除/归档（删除二次确认）、更换匹配、解除匹配

### 6.4 轻 OCR（可选开关）

**目的**：仅用于预填与去重增强，不做真伪判断。

- 识别字段（尽量克制）

  - 日期（交易/开票日期）
  - 金额（总额/实付）
  - 商户关键字（短文本）

- 输出：作为 Receipt 可编辑字段保存（ocr_date/ocr_amount/merchant_keyword）
- 开关：全局开关 + 项目级开关（默认继承全局）
- 失败策略：OCR 失败不阻断；提示“未识别，可手动填写”
- 隐私/安全：仅用于本工具内匹配建议与导出索引；文件访问需鉴权/签名

### 6.5 智能候选匹配（人工确认）

**目标**：减少在收纳箱中翻找与手动匹配成本。

- 候选生成规则（可配置）

  1. 同项目
  2. 日期接近（默认 ±3 天）
  3. 金额相同（默认容差 0；可选 0.01；不建议默认 ±1）
  4. 类别一致（若支出类别为空则不作为约束；票据类型未知也不强约束）

- 排序（建议权重）
  金额相同 > 日期更近 > 类别一致 > 备注关键词命中
- 呈现

  - Top 3 建议支出 + 置信度（高/中/低）
  - 点击“确认匹配”才绑定；可“忽略建议”

- 置信度定义（用于 UI 标签，不自动绑定）

  - 高：金额相同 + 日期 ≤1 天 +（类别一致或类别为空）
  - 中：金额相同 + 日期 ≤3 天
  - 低：金额在容差内或日期更远但关键词命中

### 6.6 批次与导出

- 创建批次

  - 日期范围（默认：上次导出后 → 今天）
  - 包含状态：默认“已关联”；缺票可选但标红警告

- 检查清单（必须）

  - 缺票支出（合计、笔数、按类别统计）
  - 疑似重复票据（hash 相同；可选增加相似度）
  - 金额不一致（当 OCR/手填金额存在时）
  - OCR 未识别/字段缺失（可选提醒）

- 导出物

  - CSV：条目清单（字段可配置）
  - ZIP：附件包（命名与 CSV 编号一致）
  - 可选 PDF：汇总索引页（编号 ↔ 附件名 ↔ 金额 ↔ 备注）

- 附件命名规则（默认）
  `序号_日期_金额_类别_备注前20字_票据ID.扩展名`

---

## 7. 非功能需求（Non-functional）

- 移动优先 PWA：可添加主屏幕；单手可用
- 性能：项目详情首屏 ≤ 2 秒（4G）；列表 1000 条可筛选不卡顿
- 可靠性：上传断网 → 本地队列重试；明确“未完成/待上传”状态
- 安全：登录鉴权；文件 URL 需签名或鉴权；删除二次确认；可选 7 天回收站
- OCR 技术约束：端侧/浏览器侧优先；服务端 OCR 需更强隐私说明与鉴权

---

## 8. 数据结构（Core Data Model）

### 8.1 Project

- project_id
- name（可空）/ code（可空，二选一必填）
- pinned（bool）
- archived（bool）
- tags[]（可选）
- created_at / updated_at

### 8.2 Expense

- expense_id, project_id
- date, amount, category?, note
- status: missing_receipt | matched | no_receipt_required
- receipt_ids[]（0..n）
- created_at / updated_at

### 8.3 Receipt

- receipt_id, project_id
- file_url, file_type, hash, uploaded_at
- ocr_amount?, ocr_date?, merchant_keyword?
- receipt_type?（交通/餐饮/其他，可选）
- matched_expense_id?（默认一对一）

### 8.4 Batch

- batch_id, project_id, name
- filter_json（日期范围/状态/类别）
- created_at
- export_records[]（格式、时间、文件路径）

---

## 9. 验收标准（Acceptance Criteria）

### MUST

1. 新增支出必须挂项目；默认进入上次项目，能一键录入。
2. 票据支持多选上传并在收纳箱预览。
3. OCR 开启时，至少 60% 常见电子票据/截图能提取到“金额或日期之一”（失败不影响主流程）。
4. 候选匹配在票据卡片展示 Top 3；点击确认才绑定；忽略不绑定。
5. 批次检查必须列出：缺票、重复（hash 相同）、金额不一致（当 OCR/手填存在）。
6. 导出 CSV 与 ZIP：ZIP 文件命名与 CSV 序号一致，可追溯。

### SHOULD

7. 新增支出（金额+备注）到列表出现路径 ≤ 3 步。
8. 票据匹配操作 ≤ 2 步（建议一键确认或手动搜索选择）。

---

# UI/UX 设计说明（移动端优先）

## 10. IA 与导航

**底部 Tab（3 个）**

1. 项目（Projects）
2. 收纳箱（Inbox）——默认显示“当前项目收纳箱”；可切“跨项目”作为后续增强
3. 设置（Settings）

**启动默认路径**：打开 App → 进入上次项目详情 → 默认 Tab=支出。

---

## 11. 交互基线（高频效率原则）

- 默认项目自动选中（上次项目）
- 快速录入固定在底部（类似聊天输入）
- 支出详情用抽屉（避免跳页）
- 匹配在票据卡片就完成（不进多层）
- 可选字段折叠（类别/标签/OCR 编辑等）

---

# 逐屏组件清单 + 交互状态表（Screen 0–9）

> 统一状态命名（供前端/设计共用）：
> `EMPTY / LOADING / ERROR / UPLOADING / UPLOAD_FAILED / OCR_PENDING / OCR_PROCESSING / OCR_FAILED / SUGGESTIONS_AVAILABLE / MATCHING / MATCH_FAILED / MATCHED / EXPORTING / EXPORT_FAILED`

---

## Screen 0：启动/鉴权（如需要）

**组件**：Splash（可选）、登录页（按实现）、全屏加载指示器
**状态**

- LOADING：`正在加载…`
- ERROR（登录失效）：`登录已过期，请重新登录` + `重新登录`
- ERROR（网络失败）：`网络不稳定，稍后再试` + `重试`

---

## Screen 1：项目列表（Projects）

**结构**：Top App Bar + 搜索 + 置顶区 + 最近区 + 归档入口（可选）
**组件**

- 标题：`项目`；右侧主按钮：`新建`
- 搜索框 placeholder：`搜索项目名/项目号`
- Project Card：项目名、项目号/最近更新、`缺票 N`、`未导出 N`
- Card 菜单（⋯）：`置顶/取消置顶`、`归档/取消归档`

**状态**

- EMPTY：`还没有项目` + `创建第一个项目`
- LOADING：卡片 skeleton 3–6
- ERROR：Banner `加载失败` + `重试`
- 搜索无结果：`没有找到匹配的项目` + `新建项目`

---

## Screen 2：新建/编辑项目（Project Create/Edit）

**组件**

- 字段：`项目名`（或 `项目号` 二选一必填）
- 可选：`标签（可选）`（chips 输入：艺人/城市/阶段）
- Toggle：`置顶项目`
- 主按钮：`保存`

**状态**

- 校验失败：`请至少填写项目名或项目号`
- 保存中：`保存中…`
- 保存失败 Toast：`保存失败，请重试`

---

## Screen 3：项目详情—支出 Tab（Expenses）

**结构**：Top App Bar（项目切换+批次入口）+ Tabs + 筛选条 + 列表 + 底部快速录入条
**组件**

- 右上入口：`批次`
- Tabs：`支出 / 票据 / 批次`
- 筛选 Chips：`全部 缺票 已关联 不需票` + 类别 Chips
- Expense Row：日期、备注、类别（可选）、金额、状态点
- Bottom Composer：金额输入、备注输入、更多、`保存`

**状态**

- EMPTY：`还没有支出记录`（高亮提示底部录入）
- LOADING：列表 skeleton 6–10
- ERROR：`加载失败` + `重试`
- 保存中：按钮 loading；防重复提交
- 保存失败 Toast：`保存失败，请重试`（内容保留）
- 筛选无结果：`当前筛选条件下没有记录` + `清除筛选`

**更多面板（Bottom Sheet）**

- 标题：`更多信息`
- 日期：`今天 / 昨天 / 选择日期`
- 类别：Chips
- 附件：`添加票据`

---

## Screen 4：支出详情抽屉（Expense Detail Drawer）

**组件**

- Header：金额 + 状态 Chip
- 字段：日期、类别、备注、状态
- 附件区：缩略图网格（2 列）+ `添加票据`
- 建议票据：Top 3 + 置信度 + `确认绑定`
- 操作：`从收纳箱选择`、`解除绑定`（仅已绑定）

**状态**

- 无建议：`暂无匹配建议`
- MATCHING：`确认绑定` loading
- MATCH_FAILED：Toast `绑定失败，请重试`
- MATCHED：状态变“已关联”
- 解除绑定：二次确认 `确定解除关联？`

---

## Screen 5：项目详情—票据 Tab（Receipts Inbox）

**组件**

- 顶部：`上传票据`（主按钮）+ OCR 状态
- Receipt Card：缩略图、OCR 字段（可编辑）、重复提示、候选匹配 Top3
- 全屏预览：缩放/左右切换
- 手动匹配选择器：搜索（备注/金额）+ 快捷排序（缺票优先/日期最近/金额相同）

**状态**

- EMPTY：`还没有票据` + `上传票据`
- UPLOADING：显示进度（单卡/全局）
- UPLOAD_FAILED：卡片 `上传失败` + `重试`
- OCR_PROCESSING：`识别中…` + 字段 skeleton
- OCR_FAILED：`未识别到金额/日期，可手动填写`
- SUGGESTIONS_AVAILABLE：展示 Top 3 + `确认匹配`
- MATCHED：`已关联到：{支出摘要}` + `更换匹配 / 解除匹配`
- 重复提示：Banner `疑似重复票据` + `查看对比`（对比页/弹层）

**按钮文案**
`上传票据 / 确认匹配 / 手动匹配 / 忽略建议 / 查看对比 / 更换匹配 / 解除匹配`

---

## Screen 6：批次列表（Batches）

**组件**：标题 `批次` + `新建批次`；批次卡片（范围/条目数/导出时间/状态）
**状态**

- EMPTY：`还没有批次` + `新建批次`
- LOADING：skeleton
- ERROR：`加载失败` + `重试`

---

## Screen 7：新建批次（Create Batch）

**组件**

- 日期范围（默认：上次导出后 → 今天）
- 包含状态：默认勾选`已关联`；可选`缺票`（警告）；`不需票`
- 可选：类别过滤
- CTA：`生成检查`

**状态**

- EXPORTING/生成中：`生成中…`
- 失败：Toast `生成失败，请重试`
  **警告文案**
  `包含缺票记录可能导致报销退回`

---

## Screen 8：批次详情（Batch Detail）

**组件**

- Summary Card：范围、条目数、缺票数、重复数、不一致数
- Issue Accordion：`缺票 / 疑似重复 / 金额不一致`
- 导出按钮：`导出清单（CSV）`、`导出票据（ZIP）`、`导出汇总（PDF）`（可选）

**状态**

- LOADING（检查中）：`正在检查…` + skeleton
- 无问题：`未发现问题，可以导出`
- 有问题：顶部提示 `建议先处理问题再导出`（仍可导出，但按钮旁显示警告）
- EXPORTING：按钮 loading
- EXPORT_FAILED：Toast `导出失败，请重试`

---

## Screen 9：设置（Settings）

**组件**

- OCR 全局开关 + 说明：`用于预填金额/日期并辅助去重，可能不准确，可随时编辑`
- 匹配策略：日期窗口（±3 天）、金额容差（0/0.01/1）、类别规则开关
- 类别管理（可选）
- 导出模板：字段勾选、排序、是否导出 PDF、命名规则展示

---

# 线框布局规格（移动端 PWA）

## 12. 基础栅格与间距

- 基准宽：375（适配 320–430）
- 页面边距：16
- 基线栅格：4pt
- 常用间距：8 / 12 / 16 / 24

## 13. 字体层级与信息优先级

- H1：20–22 SemiBold
- H2：16–18 SemiBold
- Body：15–16 Regular
- Meta：12–13 Regular
- Caption：11–12 Regular

**优先级**：金额/状态/项目名 > 事项备注 > 日期/类别/OCR

## 14. 组件尺寸建议

- Top App Bar：44
- Tab Bar：44
- Bottom Tab Bar：50–56
- Project Card：72–84
- Expense Row：64–72
- Receipt Card：120–160（含候选更高）
- 输入框：44
- Chip：28–32
- 主按钮：44–48（圆角 10–12）
- 点击热区：≥ 44×44

## 15. 列表结构（线框可直接画）

**Project Card**：左文右 badge；padding 12–16
**Expense Row**：左日期 56；右金额 88–104；中备注两行截断；状态点 8–10
**Receipt Card**：上缩略图 72–88；中 OCR 字段；下候选列表每条 44；CTA 在候选条右侧或卡片底部

## 16. 快速录入条（Bottom Composer）

- 固定高度：72–88（含安全区）
- 布局：金额（96–120）+ 备注（自适应）+ 更多（44）+ 保存（72–88）
- 更多面板：`更多信息` → 日期、类别 chips、`添加票据`

## 17. 弹层规范

- 支出详情抽屉：高度 70–90% 可滚动
- 手动匹配：全屏 Modal（搜索更顺）
- 删除/解除：系统 Modal 二次确认

---

# 视觉风格规范（中性企业工具风 + 轻量卡片）

## 18. 设计关键词

中性、克制、信息密度高；状态清晰；票据内容优先；轻动效增强顺滑。

## 19. 颜色 Tokens（建议）

- Neutral：Bg/0 #FFFFFF；Bg/1 #F7F8FA；Border #E6E8EC
- Text：Primary #111827；Secondary #6B7280；Tertiary #9CA3AF
- Primary：#2563EB（主操作）
- Semantic：Success #16A34A；Warning #D97706；Danger #DC2626；Info #0EA5E9

**规则**：列表不整行上色；用状态点+短标签；Warning/Danger 仅局部提示条。

## 20. 字体、圆角、阴影、动效

- 系统字体；卡片圆角 12；按钮 10–12；输入 10；chips 胶囊
- 优先 1px 边框分隔，少量轻阴影用于浮层
- 动效：列表淡入 120ms；Bottom Sheet 220ms；Toast 180ms

---

# 文案与提示策略（防误操作）

- OCR 字段旁提示：`可编辑`、`可能不准确`（弱提示）
- 确认匹配弹窗展示对比：票据日期/金额 vs 支出日期/金额（差异高亮）
- 重复提示不阻断，但在批次检查必须再次出现
- 关键 Toast：`已保存 / 上传失败，请重试 / 已关联 / 导出失败，请重试`

---

# 风格落地避免跑偏（约束）

1. 不做记账式图表与仪表盘
2. 不让颜色承载全部信息（必须有文案/图标）
3. OCR 字段默认不抢空间（可编辑但克制）
4. 候选匹配必须人工确认，确认前必须对比信息展示

---

- techdesign.md
